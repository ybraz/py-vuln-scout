{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://github.com/py-vuln-scout/schemas/finding.schema.json",
  "title": "Finding Schema",
  "description": "Schema for vulnerability findings output",
  "type": "object",
  "required": [
    "id",
    "cwe_id",
    "rule_id",
    "engine",
    "severity",
    "confidence",
    "file_path",
    "line_start",
    "line_end",
    "snippet",
    "evidence",
    "validator_status",
    "timestamps",
    "metadata"
  ],
  "properties": {
    "id": {
      "type": "string",
      "format": "uuid",
      "description": "Unique identifier for this finding (UUID v4)"
    },
    "cwe_id": {
      "type": "string",
      "pattern": "^CWE-[0-9]+$",
      "description": "CWE identifier"
    },
    "rule_id": {
      "type": "string",
      "description": "Rule that triggered this finding"
    },
    "engine": {
      "type": "string",
      "enum": ["regex", "llm", "merged"],
      "description": "Analysis engine that produced this finding"
    },
    "severity": {
      "type": "string",
      "enum": ["LOW", "MEDIUM", "HIGH", "CRITICAL"],
      "description": "Severity level"
    },
    "confidence": {
      "type": "number",
      "minimum": 0.0,
      "maximum": 1.0,
      "description": "Confidence score (0-1)"
    },
    "file_path": {
      "type": "string",
      "description": "Path to the analyzed file"
    },
    "line_start": {
      "type": "integer",
      "minimum": 1,
      "description": "Starting line number"
    },
    "line_end": {
      "type": "integer",
      "minimum": 1,
      "description": "Ending line number"
    },
    "snippet": {
      "type": "string",
      "description": "Code snippet showing the vulnerability"
    },
    "evidence": {
      "type": "array",
      "items": {
        "type": "object",
        "required": ["line_start", "line_end", "snippet"],
        "properties": {
          "line_start": {
            "type": "integer",
            "minimum": 1
          },
          "line_end": {
            "type": "integer",
            "minimum": 1
          },
          "snippet": {
            "type": "string"
          },
          "source": {
            "type": ["string", "null"],
            "description": "Taint source identifier"
          },
          "sink": {
            "type": ["string", "null"],
            "description": "Taint sink identifier"
          }
        }
      }
    },
    "validator_status": {
      "type": "string",
      "enum": ["skipped", "confirmed", "rejected", "inconclusive"],
      "description": "Validation status from validator engine"
    },
    "poc": {
      "type": ["object", "null"],
      "description": "Proof-of-concept information (when validated)",
      "properties": {
        "best_payload": {
          "type": "string",
          "description": "Suggested exploit payload"
        },
        "attack_vector": {
          "type": "string",
          "description": "Description of the attack vector"
        },
        "steps": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Steps to reproduce the vulnerability"
        }
      }
    },
    "explanation": {
      "type": ["object", "null"],
      "description": "Human-readable explanation (when requested)",
      "properties": {
        "risk": {
          "type": "string",
          "description": "Risk description (2-4 sentences)"
        },
        "impact": {
          "type": "array",
          "items": {"type": "string"},
          "description": "List of potential impacts"
        },
        "fix": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Recommended fixes with examples"
        }
      }
    },
    "merge_reason": {
      "type": ["string", "null"],
      "description": "Reason for merge decision",
      "enum": ["regex_llm_agreement", "validator_confirmed", "validator_skipped_discarded", null]
    },
    "timestamps": {
      "type": "object",
      "required": ["analyzed_at"],
      "properties": {
        "analyzed_at": {
          "type": "string",
          "format": "date-time",
          "description": "ISO8601 timestamp of analysis"
        }
      }
    },
    "metadata": {
      "type": "object",
      "properties": {
        "model_name": {
          "type": ["string", "null"],
          "description": "LLM model used (if applicable)"
        },
        "latency_ms": {
          "type": ["number", "null"],
          "description": "Analysis latency in milliseconds"
        },
        "fingerprint": {
          "type": ["string", "null"],
          "description": "Stable hash of the code snippet"
        }
      }
    }
  }
}
